<html>
<head>
<script>
var colorPicked = null;

chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
    if(request.reqtype == "get-shot") {
      chrome.tabs.captureVisibleTab(null, function(dataURL) { 
        sendResponse({dataURL: dataURL})
      });

    } else if(request.reqtype == "set-color") {
        colorPicked = request.color.rgbhex;
        chrome.browserAction.setBadgeText({text: 'N'});
        chrome.browserAction.setBadgeBackgroundColor({color: [request.color.r, request.color.g, request.color.b, 255]});

        if ( localStorage != null && window.localStorage['autoClipboard'] === "true" ) {
          // save to clipboard
          var edCb = document.getElementById('edClipboard');
          edCb.value = '#'+colorPicked; 
          edCb.select();
          document.execCommand("copy", false, null);
        }

        // send response
        sendResponse({text: colorPicked});
    } else if(request.reqtype == "get-color") {
        sendResponse({color: colorPicked});

    } else
        sendResponse({});
});
</script>
</head>
<body>
  <textarea id="edClipboard"></textarea>
</body>
</html>
